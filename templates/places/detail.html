{% extends "base.html" %}
{% load static %}

{% block title %}{{ place.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-8">
      {% if place.image %}
        <img src="{{ place.image.url }}" class="img-fluid rounded shadow-sm mb-3" alt="{{ place.name }}">
      {% endif %}

      <h2>{{ place.name }}</h2>
      <p class="text-muted">{{ place.location }}</p>
      <p>{{ place.description }}</p>

      <!-- Add to Itinerary -->
      {% if user.is_authenticated %}
        <form method="POST" action="{% url 'add_to_itinerary' place.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-success mt-2">Add to My Itinerary</button>
        </form>

        {% if user.is_authenticated %}
        <form method="POST" action="{% url 'add_to_favorites' place.id %}" class="mt-2">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger">
            ‚ù§Ô∏è Add to Favorites
          </button>
        </form>
      {% endif %}
      
      <hr>
      <h4 class="mt-5">Reviews</h4>

      {% for review in reviews %}
        <div class="border rounded p-2 mb-2">
          <strong>{{ review.name }}</strong> ‚Äî ‚≠ê {{ review.rating }}/5<br>
          <small>{{ review.created_at|date:"M d, Y" }}</small>
          <p>{{ review.comment }}</p>
        </div>
      {% empty %}
        <p>No reviews yet. Be the first to review!</p>
      {% endfor %}

      <div class="mt-4">
        <h5>Add a Review</h5>
        <form method="post" class="border rounded p-3 shadow-sm bg-light">
          {% csrf_token %}
          <div class="mb-3">
            {{ form.name.label_tag }}
            {{ form.name }}
          </div>
          <div class="mb-3">
            {{ form.rating.label_tag }}
            {{ form.rating }}
          </div>
          <div class="mb-3">
            {{ form.comment.label_tag }}
            {{ form.comment }}
          </div>
          <button type="submit" class="btn btn-primary">Submit Review</button>
        </form>
      </div>
    </div>

    <div class="col-md-4">
      <h4 class="mb-3">Nearby Hotels</h4>
      {% for hotel in related_hotels %}
        <div class="card mb-3 shadow-sm border-0">
          {% if hotel.image %}
            <img src="{{ hotel.image.url }}" class="card-img-top" alt="{{ hotel.name }}">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ hotel.name }}</h5>
            <p class="card-text">{{ hotel.address }}</p>
            <p class="text-muted mb-1">{{ hotel.price_range }}</p>
            {% if hotel.contact %}
              <small class="text-muted">üìû {{ hotel.contact }}</small>
            {% endif %}
          </div>
        </div>
      {% empty %}
        <p class="text-muted">No hotels listed for this place yet.</p>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}
