{% extends "base.html" %}
{% load static %}

{% block title %}{{ place.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-8">
      {% if place.image %}
        <img src="{{ place.image.url }}" class="img-fluid rounded shadow-sm mb-3" alt="{{ place.name }}">
      {% endif %}

      <h2>{{ place.name }}</h2>
      <p class="text-muted">{{ place.location }}</p>
      <p>{{ place.description }}</p>

      {% if weather %}
      <div class="alert alert-info mt-3">
        <h5>üå§ Current Weather in {{ weather.city }}</h5>
        <p>
          <img src="http://openweathermap.org/img/wn/{{ weather.icon }}@2x.png" alt="Weather Icon" style="vertical-align: middle;">
          {{ weather.temp }}¬∞C ‚Äî {{ weather.description }}
        </p>
      </div>
      {% endif %}
      {% if weather %}
        <!-- display weather -->
      {% else %}
        <p class="text-muted">Weather info unavailable.</p>
      {% endif %}



      <!-- Add to Itinerary -->
      {% if user.is_authenticated %}
        <form method="POST" action="{% url 'add_to_itinerary' place.id %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-success mt-2">Add to My Itinerary</button>
        </form>

        <!-- Favorites -->
        {% if is_favorite %}
          <form method="POST" action="{% url 'remove_from_favorites' place.id %}" class="mt-2">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">
              üíî Remove from Favorites
            </button>
          </form>
        {% else %}
          <form method="POST" action="{% url 'add_to_favorites' place.id %}" class="mt-2">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger">
              ‚ù§Ô∏è Add to Favorites
            </button>
          </form>
        {% endif %}
      {% endif %}

      <hr>
      <h4 class="mt-5">Reviews</h4>

      <!-- Average rating -->
      {% if average_rating %}
        <p>
          <strong>Average Rating:</strong>
          {% for _ in "12345" %}
            {% if forloop.counter <= average_rating %}
              <span class="text-warning">‚òÖ</span>
            {% else %}
              <span class="text-muted">‚òÜ</span>
            {% endif %}
          {% endfor %}
          ({{ average_rating|floatformat:1 }}/5)
        </p>
      {% endif %}

      <!-- Review List -->
      {% for review in reviews %}
        <div class="border rounded p-2 mb-2">
          <strong>{{ review.user.username }}</strong>
          <span>
            {% for _ in "12345" %}
              {% if forloop.counter <= review.rating %}
                <span class="text-warning">‚òÖ</span>
              {% else %}
                <span class="text-muted">‚òÜ</span>
              {% endif %}
            {% endfor %}
          </span>
          <br>
          <small>{{ review.created_at|date:"M d, Y" }}</small>
          <p>{{ review.comment }}</p>
        </div>
      {% empty %}
        <p>No reviews yet. Be the first to review!</p>
      {% endfor %}

      <!-- Review Form -->
      {% if user.is_authenticated %}
        <div class="mt-4">
          <h5>Add a Review</h5>
          <form method="post" class="border rounded p-3 shadow-sm bg-light">
            {% csrf_token %}
            <div class="mb-3">
              {{ form.rating.label_tag }}
              {{ form.rating }}
            </div>
            <div class="mb-3">
              {{ form.comment.label_tag }}
              {{ form.comment }}
            </div>
            <button type="submit" class="btn btn-primary">Submit Review</button>
          </form>
        </div>
      {% else %}
        <p><a href="{% url 'login' %}">Login</a> to write a review.</p>
      {% endif %}

    </div>

    <!-- Nearby Hotels -->
    <div class="col-md-4">
      <h4 class="mb-3">Nearby Hotels</h4>
      {% for hotel in related_hotels %}
        <div class="card mb-3 shadow-sm border-0">
          {% if hotel.image %}
            <img src="{{ hotel.image.url }}" class="card-img-top" alt="{{ hotel.name }}">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title">{{ hotel.name }}</h5>
            <p class="card-text">{{ hotel.address }}</p>
            <p class="text-muted mb-1">{{ hotel.price_range }}</p>
            {% if hotel.contact %}
              <small class="text-muted">üìû {{ hotel.contact }}</small>
            {% endif %}
          </div>
        </div>
      {% empty %}
        <p class="text-muted">No hotels listed for this place yet.</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
